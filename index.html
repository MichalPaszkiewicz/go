<head>
    <title>play go!</title>
    <meta name="description" content="A multiplayer browser based game of go implementing PeerJS">
    <meta name="viewport" content="width=700, initial-scale=0.5">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="http://cdn.peerjs.com/0.3/peer.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="connect.js"></script>
	<script type="text/javascript" src="board.js"></script>
	<script type="text/javascript" src="cell-finder.js"></script>
	<script type="text/javascript" src="go-rules.js"></script>
    <script type="text/javascript" src="test-bed.js"></script>
    <script type="text/javascript" src="display-updater.js"></script>
    <script type="text/javascript" src="ai.js"></script>

    <!--codemirror libraries-->
    <script src="codemirror/codemirror.js"></script>
    <link href="codemirror/codemirror.css" rel="stylesheet" />
    <script src="codemirror/javascript.js"></script>
    <link href="codemirror/ambiance.css" rel="stylesheet" />

    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-52254492-1', 'michalpaszkiewicz.co.uk');
        ga('send', 'pageview');

    </script>
</head>
<body>

    <div class="main-container">
        <div id="panel1" class="panel">
            <div id="player-notifier">
      	    	<div id="move-notifier">White to move</div>
      	    	<span id="player-colour"></span>
      	    </div>
            <div class="panel-box">
                <h1>go!</h1>
                <h2>Play go online with friends using <a href="http://peerjs.com/" target="_blank">Peerjs</a></h2>
                <div id="GameSettings">
                	<div id="GamesSettingsLink" class="hidden">
                		<span id="friend-link-text" class="labelspan">Send this link to a friend: </span>	
                		<input class="friend-link"></input>
                	</div>
                </div>
            </div>
        </div>
        <div class="panel">
            <div class="game-board">
                <table id="games-table" class="hidden" style=""></table>
            </div>
            <div class="data"></div>
            <div class="chatbox">
                Message: <input class="message" />
                <button id="send">Send</button>
            </div>
            <div class="infobox">
            	<div class="item"><span class="labelspan">Board size</span><input type="number" id="BoardSize" min="7" max="21" value="11"></input></div>
		<div class="item"><span class="labelspan">Game mode</span>
			<select id="game-mode-select">
  				<option value="online">Online</option>
  				<option value="local">Local</option>
				<option value="AI">AI</option>
			</select></div>
		<div class="item player-item"><span class="labelspan">Play as</span>
			<input type="radio" name="player" value=1 checked>White
			<input type="radio" name="player" value=2>Black
		</div>
		<div class="item"><button onclick="newSettings(); sendSettings();">New game</button></div>
            </div>
            <div id="custom-coder"></div>
        </div>
        <div class="push"></div>
    </div>
    <div class="footer">
        <div class="panel-box">
            <a href="http://www.michalpaszkiewicz.co.uk">Home</a>
            <a href="http://lmgtfy.com/?q=how+to+play+go" target="_blank">How to play</a>
        </div>
    </div>

    <script>
        $('.him-her').keypress(function (e) {
            if (e.keyCode == 13)
                $('#connect').click();
        });
        $('.message').keypress(function (e) {
            if (e.keyCode == 13)
                $('#send').click();
        });

        function setTable(newSize) {
            size = newSize
            gameMode = $("#game-mode-select").val();
            $("table").html(getNewTableHtml(newSize));	
            $("table").removeClass("hidden");
            if(host == 1 && gameMode == "online")
            {
            	$("#GamesSettingsLink").removeClass("hidden");
            }
            if(gameMode == "local" || gameMode == "AI")
            {
            	$("#GamesSettingsLink").addClass("hidden");
            }
            initiateArray();
           
           updateDisplay(); 
            
        };
        
        function getNewTableHtml(newSize)
        {
            $('table').width(51 * newSize);
            var html = "";
            for (var i = newSize - 1; i > -1; i--) {
                html += "<tr>";
                for (var j = 0; j < newSize; j++) {
                    html += "<td id=i" + j + "j" + i + "><div class='counter'></div></td>";
                }
                html += "</tr>";
            }
            return html;
        }
        
        //setTable(11);

        var customCodeNode = document.getElementById("custom-coder");
        var myCodeMirror = CodeMirror(customCodeNode, {
            lineNumbers: true,
            theme: "ambiance"
        });
	myCodeMirror.getDoc().setValue("\t/***Insert code here!***/\r\n\t/*You can get the values on the board from: array[x][y]*/\r\n\tvar legalMoves = getLegalMoves(player);\r\n\tvar lm = Math.floor(legalMoves.length * Math.random());\r\n\tvar x = legalMoves[lm].xPos;\r\n\tvar y = legalMoves[lm].yPos;\r\n\taddMove(x,y,player)");

        $("#custom-coder").append("<div class='custom-coder-settings'><input id='IsUserAI' type='checkbox' name='IsUserAI'>Run code automatically</input>" 
            + "<button onclick='autoMove()'>Run code</button><div class='clearfix'></div></div>");

	function autoMove()
	{
		eval(myCodeMirror.getValue());
		if(gameMode == "AI")
		{
			aiMove();
		}
	}
	
	function newSettings()
	{
		if(gameMode == "online")
		{
			player = parseInt($('input[name=player]:checked').val());
		}
		else
		{
			player = 1;
			currentTurn = 1;
		}
		host = 1; 
		setTable($('#BoardSize').val());
	}
	
	$("#game-mode-select").change(function(){
		if($("#game-mode-select").val() == "online")
		{
			$(".player-item").removeClass("hidden");
		}
		else
		{
			$(".player-item").addClass("hidden");	
		}
		
	});
    </script>

</body>
